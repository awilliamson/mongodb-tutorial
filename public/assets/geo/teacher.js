function help(){$("#results").html('<div id="help"><p>'+teacher.currentStep.help()+"</p><br/><br/>or<br/><br/><p>Type <strong>restart</strong> to start this tutorial over</p><p><strong>lesson(X)</strong> to jump to lesson # X</p><p><strong>ctrl,</strong> to slow things down</p><p><strong>ctrl.</strong> to speed things up</p><p>You can also click the speed button in the upper right to change the speed<p></div>")}function reset(){lesson(teacher.currentStep.index)}function restart(){lesson(0)}function lesson(step){with(window)var targetStep=eval("teacher.step"+step);targetStep&&(teacher.interval&&clearInterval(teacher.interval),teacher.timeout&&clearTimeout(teacher.timeout),teacher.start(step))}Object.size=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&++n;return n};var teacher={currentStep:null,speeds:[2,1.5,1.25,1,.75,.5,.25,.1],speedIndex:2,input:null,$input:null,start:function(step){if(teacher.input=document.getElementById("input"),teacher.$input=$(teacher.input),step)with(window)return eval("teacher.step(teacher.step"+step+");");else teacher.step(teacher.step0)},got:function(e,t){teacher.currentStep.finish(e,t)},step:function(e){return teacher.$input.css({backgroundColor:""}),$("#lesson").text("lesson: "+e.index),e.start(),teacher.currentStep=e,null},wrong:function(){return $("#history").inputHistory({command:"add",type:"teach",html:"That's not quite right. Enter <strong>help</strong> if you are stuck"}),null},speedUp:function(){teacher.changeSpeed(teacher.speedIndex+1)},slowDown:function(){teacher.changeSpeed(teacher.speedIndex-1)},changeSpeed:function(e){e<teacher.speeds.length&&e>-1&&(teacher.speedIndex=e,$("#speed").text("speed "+e),clearTimeout(teacher.timeout),teacher.say(teacher.currentLecture,teacher.currentCallback,teacher.currentIndex))},canExecute:function(e){return e.teacherName&&"find"==e.teacherName()?!0:teacher.currentStep.canExecute&&!teacher.currentStep.canExecute(e)?(teacher.wrong(),!1):!0},specialHandling:function(e){return teacher.currentStep.specialHandling&&teacher.currentStep.specialHandling(e)},isId:function(e,t,n){return e&&e[t]&&e[t].$oid&&e[t].$oid==n},say:function(e,t,n){n||(n=0),n>=e.length||(teacher.currentIndex=n,teacher.currentLecture=e,teacher.currentCallback=t,teacher.timeout=setTimeout(function(){var o=e[n++][1];"function"==typeof o?o():$("#history").inputHistory({command:"add",type:"teach",html:o}),n<e.length?teacher.say(e,t,n):t&&t()},(0==n?0:e[n-1][0])*teacher.speeds[teacher.speedIndex]))},commandFor:function(e,t,n){return e&&e.teacherName&&e.teacherName()==t&&e._collection._name==n},blockInput:function(){teacher.input.disabled=!0},unblockInput:function(){teacher.input.disabled=!1},waitingAnswer:function(){teacher.$input.css({backgroundColor:"#efe"}).focus()}};teacher.step0={index:0,start:function(){teacher.say([[4e3,"Welcome to a quick 5 minute interactive MongoDB Geospatial Tutorial. In this tutorial you'll learn about MongoDB's great geospatial capabilities"],[3500,"At any point, you can get help by entering <strong>help</strong>"],[4500,'If you are new to MongoDB, you might want to check out the <a href="/tutorial/index">MongoDB Interactive Tutorial</a> first'],[4500,'I also wrote a free ebook you might be interested in: <a href="http://openmymind.net/2011/3/28/The-Little-MongoDB-Book" target="_blank">The Little MongoDB Book</a>'],[2e3,"Let's start"],[3500,"MongoDB's geospatial features let you find documents based on coordiates (x,y)"],[500,'In the bottom right you see a 50x50 grid. <span style="color:#f00">0,0</span> is in the middle'],[3e3,function(){grid.highlight([0,0],"#f00")}],[500,'The top left is <span style="color:#00f">-25,-25</span>'],[3e3,function(){grid.highlight([-25,-25],"#00f")}],[500,'The bottom right is <span style="color:#0f0">24,24</span>'],[3e3,function(){grid.highlight([24,24],"#0f0")}]],function(){teacher.step(teacher.step1)})},help:function(){return"Just watch and enjoy the light show"}},teacher.step1={index:1,start:function(){teacher.say([[6e3,"Don't get too excited, but we have a collection, called <strong>treasures</strong>, containing information on a bunch of treasures located in our grid."],[5e3,"Go ahead and look at the collection"],[10,function(){grid.clear()}]],teacher.awaitingAnswer)},help:function(){return"Enter <strong>db.treasures.find();</strong>"},specialHandling:function(e){return teacher.commandFor(e,"find","treasures")?teacher.step(teacher.step2):teacher.wrong(),!0}},teacher.step2={index:2,start:function(){teacher.say([[3e3,"HAHAHAHAH, you actually thought it would be that easy, didn't you?"],[4e3,"Seriously though, I'll tell you that each document within <strong>treasures</strong> has a <strong>location</strong> field"],[4e3,"The location value is a nested document. For example: <strong>{type: 'gold', location: {x: 20, y:-10}}</strong>"],[4e3,"We could also have used an array <strong>{type: 'gold', location:[20,-10]}</strong>..same same"],[5e3,"Anyways, to get MongoDB to treat these as coordinates, we must create a <storng>2d</strong> index on the field"],[5e3,"By default, indexes use -180..180 (longitude/latitude), but we need -25..25, so, enter this:"],[1e3,"<strong>db.treasures.ensureIndex({location: '2d'}, {min:-25, max:25});</strong>"]],teacher.awaitingAnswer)},help:function(){return"Enter <strong>db.treasures.ensureIndex({location: '2d'}, {min:-25, max:25});</strong>"},specialHandling:function(e){return teacher.commandFor(e,"ensureIndex","treasures")&&e._fields&&1==Object.size(e._fields)&&"2d"==e._fields.location&&e._options&&2==Object.size(e._options)&&25==e._options.max&&-25==e._options.min?teacher.step(teacher.step3):teacher.wrong(),!0},finish:function(){return teacher.wrong()}},teacher.step3={index:3,start:function(){teacher.say([[1e3,"Great work"],[5e3,"What we want to do is use the <strong>$near</strong> conditional operator to <strong>find</strong> all the <strong>treasures</strong> near [20,-20]"],[2e3,"Can you guess how to do that?"]],teacher.awaitingAnswer)},help:function(){return"Enter <strong>db.treasures.find({location: {$near: [20, -20]}});</strong>"},finish:function(e,t){return teacher.commandFor(t,"find","treasures")&&1==Object.size(t._selector)&&t._selector.location&&t._selector.location.$near&&20==t._selector.location.$near[0]&&-20==t._selector.location.$near[1]?(grid.displayResults(e.documents),teacher.step(teacher.step4)):teacher.wrong()}},teacher.step4={index:4,start:function(){teacher.say([[4e3,"MongoDB automatically sorts the results from closest to farthest. Neat, huh?"],[5e3,"2d indexes can participate in compound indexes. Let me change the index to also include <strong>type</strong>"],[1e3,"First, we drop it"]],teacher.step4.alpha)},help:function(){return"there should be nothing to do"},alpha:function(){executor.rawExecute("db.treasures.dropIndexes();")},finish:function(){return teacher.step(teacher.step5)}},teacher.step5={index:5,start:function(){teacher.say([[1e3,"Next we re-create it"]],teacher.step5.alpha)},help:function(){return"there should be nothing to do"},alpha:function(){executor.rawExecute("db.treasures.ensureIndex({location: '2d', type: 1}, {min:-25, max:25});")},finish:function(){return teacher.step(teacher.step6)}},teacher.step6={index:6,start:function(){teacher.say([[4e3,"Now queries involving both <strong>location</strong> and <strong>type</strong> will be faster than fast"],[3e3,"Using <strong>$near</strong> automatically limits results to 100 records"],[3e3,"How would you only get the 5 nearest <strong>gold</strong> treasures from the center?"]],teacher.awaitingAsnwer)},help:function(){return"Enter <strong>db.treasures.find({location: {$near: [0, 0]}, type: 'gold'}).limit(5);</strong>"},finish:function(e,t){return teacher.commandFor(t,"find","treasures")&&2==Object.size(t._selector)&&t._selector.location&&t._selector.location.$near&&0==t._selector.location.$near[0]&&0==t._selector.location.$near[1]&&"gold"==t._selector.type&&t._limit&&5==t._limit?teacher.step(teacher.step7):teacher.wrong()}},teacher.step7={index:7,start:function(){teacher.say([[3e3,"Well done. Just a few more things to look at before we are done"],[4e3,"First, in additional to <strong>$near</strong>, we can specify <strong>$maxDistance</strong>"],[3e3,"So, to get all the treasure within a distance of 10 from [0,0], you would...?"]],teacher.awaitingAsnwer)},help:function(){return"Enter <strong>db.treasures.find({location: {$near: [0, 0], $maxDistance: 10}});</strong>"},finish:function(e,t){return teacher.commandFor(t,"find","treasures")&&1==Object.size(t._selector)&&t._selector.location&&t._selector.location.$near&&0==t._selector.location.$near[0]&&0==t._selector.location.$near[1]&&10==t._selector.location.$maxDistance?teacher.step(teacher.step8):teacher.wrong()}},teacher.step8={index:8,start:function(){teacher.say([[1e3,"Good job"],[3500,"We can also use <strong>$within</strong> to limit our search inside a <strong>box</strong> or a <strong>circle</strong>"],[3e3,"To use a box, we specify the top-left and lower-right corners"],[6e3,"For example, <strong>db.treasures.find({location: {$within: {$box: [[-20, -20], [-10, -10]]}}});</strong> would find treasures in the top-left quadrant"],[5e3,"For a circle, you specify a <strong>$center</strong> with a specific point and a radius, like <strong>$center: [[0,0], 10]</strong>"],[3e3,"Go ahead and find all treasures centered at -5,-7 with a radius of 11"]],teacher.awaitingAsnwer)},help:function(){return"Enter <strong>db.treasures.find({location: {$within: {$center: [[-5, -7], 11]}}});</strong>"},finish:function(e,t){return teacher.commandFor(t,"find","treasures")&&1==Object.size(t._selector)&&t._selector.location&&t._selector.location.$within&&t._selector.location.$within.$center&&-5==t._selector.location.$within.$center[0][0]&&-7==t._selector.location.$within.$center[0][1]&&11==t._selector.location.$within.$center[1]?teacher.step(teacher.step9):teacher.wrong()}},teacher.step9={index:9,start:function(){teacher.say([[1e3,"And that, is that."],[3500,"There's a bit more to MongoDB's geospatial capabilities that what we've seen here"],[4e3,'If you are interested, head over to the <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing">geospatial indexing</a> page'],[6e3,'Or, better yet, head over to <a href="http://www.mongodb.org/downloads">the mongodb download</a> page, grab the version for your OS and experiment on your local machine'],[5e3,"The precompiled binaries available for Linux, Windows and OS X make MongoDB extremely easy to get started with"],[4500,'Don\'t forget to check out my <a href="http://openmymind.net/2011/3/28/The-Little-MongoDB-Book" target="_blank">free MongoDB ebook</a>'],[1e3,"You are now web scale"]],teacher.awaitingAsnwer)},help:function(){return"Well done, you are finished!"},finish:function(){}},$(document).keydown(function(e){e.ctrlKey&&190==e.which?teacher.speedUp():e.ctrlKey&&188==e.which&&teacher.slowDown()});