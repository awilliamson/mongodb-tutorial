!function(t){var e={max:100,target:null};t.fn.inputHistory=function(i){if(i||(i={}),"add"==i.command)return this.each(function(){this.inputHistory.add(i)});if("selectPrevious"==i.command)return this.each(function(){this.inputHistory.selectPrevious()});if("selectNext"==i.command)return this.each(function(){this.inputHistory.selectNext()});var n=t.extend({},e,i);return this.each(function(){if(this.inputHistory)return!1;var e=t(this),i=0,r=0,o="",a={initialize:function(){e.delegate("#"+e.attr("id")+" > div:not(.teach)","click",a.clicked)},add:function(o){var c=t("<div>").addClass(o.type);o.text&&c.append(t("<span>").text(o.text)),o.html&&c.append(t("<span>").html(o.html)),o.time&&c.append(t("<span>").addClass("time").text(o.time)),e.append(c),e.scrollTop(e[0].scrollHeight),++i>=n.max&&a.trim(i-n.max),r=0},trim:function(t){for(var i=0;t>i;++i)e.children(":first").remove()},clicked:function(){var e=t(this).find("span:first").text();n.target.commandInput({command:"set",text:e})},selectPrevious:function(){0==r&&(o=n.target.val());var t=i-(r+1);if(!(0>t)){++r;var c=e.children(":eq("+t+")");if(c.is(".teach"))return a.selectPrevious(),void 0;c.click(),-1!=c.text().indexOf("\n")&&n.target.setSelectionRange(0,0)}},selectNext:function(){var t=i-(r-1);if(t==i&&(r=0),t>=i)return n.target.commandInput({command:"set",text:o}),void 0;--r;var c=e.children(":eq("+t+")");return c.is(".teach")?(a.selectNext(),void 0):(c.click(),void 0)}};this.inputHistory=a,a.initialize()})}}(jQuery);