!function(e){var t={max:100,target:null};e.fn.inputHistory=function(n){if(n||(n={}),"add"==n.command)return this.each(function(){this.inputHistory.add(n)});if("selectPrevious"==n.command)return this.each(function(){this.inputHistory.selectPrevious()});if("selectNext"==n.command)return this.each(function(){this.inputHistory.selectNext()});var r=e.extend({},t,n);return this.each(function(){if(this.inputHistory)return!1;var t=e(this),n=0,i=0,o="",s={initialize:function(){t.delegate("#"+t.attr("id")+" > div:not(.teach)","click",s.clicked)},add:function(o){var a=e("<div>").addClass(o.type);o.text&&a.append(e("<span>").text(o.text)),o.html&&a.append(e("<span>").html(o.html)),o.time&&a.append(e("<span>").addClass("time").text(o.time)),t.append(a),t.scrollTop(t[0].scrollHeight),++n>=r.max&&s.trim(n-r.max),i=0},trim:function(e){for(var n=0;e>n;++n)t.children(":first").remove()},clicked:function(){var t=e(this).find("span:first").text();r.target.commandInput({command:"set",text:t})},selectPrevious:function(){0==i&&(o=r.target.val());var e=n-(i+1);if(!(0>e)){++i;var a=t.children(":eq("+e+")");if(a.is(".teach"))return s.selectPrevious(),void 0;a.click(),-1!=a.text().indexOf("\n")&&r.target.setSelectionRange(0,0)}},selectNext:function(){var e=n-(i-1);if(e==n&&(i=0),e>=n)return r.target.commandInput({command:"set",text:o}),void 0;--i;var a=t.children(":eq("+e+")");return a.is(".teach")?(s.selectNext(),void 0):(a.click(),void 0)}};this.inputHistory=s,s.initialize()})}}(jQuery);